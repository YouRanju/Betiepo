window.onload = init;

//아이템 추가
var items;
var item;
var newitem;
var newnode = [];

// 새로만들기
var create;

//검색
var searchinput;

function init() {
    
    items = document.getElementsById('items');
    item = document.getElementsByClassName('item')[0];
 
    removetext(items);
    
    for(var i = 1; i < items.childElementCount; i++) {
        newnode.push(items.childNodes[i]);
    }

    s = 0;

    while(s < newnode.length) {
        removetext(newnode[s]);
        removetext(newnode[s].childNodes[0]);
        s++;
    }

    for(var i = 0; i < newnode.length; i++) {
        localStorage.setItem('node' + i, newnode[i].innerHTML);
    }    

    //새로 만들기
    createlink = create.childNodes[1].childNodes[1];
    createlink.href = '../html/main.html';
    createlink = create.childNodes[1].childNodes[3].childNodes[1];
    createlink.href = '../html/main.html';

    //검색 input창
    searchinput = document.getElementById('searchinput');
    searchinput.onkeydown = goSearch;
}

function count(e) {
    for(var i = 0; i < newnode.length; i++) {
        if(e.target == newnode[i].childNodes[0].childNodes[1].childNodes[1]) {
            localStorage.setItem('clicked', i);
        }
    }
}

function goSearch(e) {
    //검색기능 - 서버에서 작동해보세여...
    if(e.keyCode == 13) {
        alert(searchinput.value);
    }
}

function removetext(node) {
    //node중에서 text를 없애는 함수
    i=0;
    for(var value of node.childNodes.values()) {
        if(value.nodeName == '#text') {
            node.removeChild(node.childNodes[i]);
        }
        i++;
    }
}

var Max;
var index = 0;

function copy() {
    //프로젝트를 추가했을 때 만들어지는 함수
    items.removeChild(items.lastChild);

    var cloneE = item.cloneNode(true);
    var cloneCreate = create.cloneNode(true);

    explanDate(cloneE);

    cloneE.style.display = 'block';

    items.appendChild(cloneE);
    items.appendChild(cloneCreate);

    removetext(items);

    if(localStorage.getItem('index') != null) {
        index = localStorage.getItem('index');
        index++;
        localStorage.setItem('index', index);
    } else {
        localStorage.setItem('index', index);
    }

    localStorage.setItem('items', items.innerHTML);
}

function explanDate(node) {
    //생성날짜를 표기하는 함수
    createdate = node.getElementsByClassName('date')[0];
    today = new Date();

    createdate.innerHTML = today.getFullYear() + "년 " + (today.getMonth()+1) + "월 " + today.getDate() + "일";
}